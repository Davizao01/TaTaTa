<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo Dragon Ball Online</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #282c34;
            color: white;
            text-align: center;
        }
        #menu, #game, #arena {
            display: none;
        }
        #map {
            position: relative;
            width: 600px; 
            height: 600px; 
            margin: 20px auto;
            border: 1px solid #fff;
            overflow: hidden;
            background-color: #444; /* Cor do fundo do mapa */
        }
        .player {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #00ff00; /* Cor do jogador */
        }
        .item {
            position: absolute;
            width: 15px;
            height: 15px;
            background-color: #ffcc00; /* Cor do item */
        }
        button {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        #status {
            margin: 20px;
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>Jogo Dragon Ball Online</h1>
    <div id="menu">
        <button id="startButton">Iniciar Aventura</button>
        <button id="arenaButton">Arena PvP</button>
    </div>
    <div id="game">
        <button id="backButton">Voltar ao Menu</button>
        <div id="status"></div>
        <div id="map"></div>
    </div>
    <div id="arena">
        <button id="backArenaButton">Voltar ao Menu</button>
        <h2>Arena PvP</h2>
        <div id="arenaMap" style="width: 600px; height: 400px; border: 1px solid #fff; margin: auto; background-color: #444;"></div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const mapDiv = document.getElementById('map');
        const startButton = document.getElementById('startButton');
        const arenaButton = document.getElementById('arenaButton');
        const backButton = document.getElementById('backButton');
        const backArenaButton = document.getElementById('backArenaButton');
        let players = {};
        let items = {};

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('menu').style.display = 'block';

            startButton.addEventListener('click', () => {
                document.getElementById('menu').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                socket.emit('startGame');
            });

            arenaButton.addEventListener('click', () => {
                document.getElementById('menu').style.display = 'none';
                document.getElementById('arena').style.display = 'block';
                // Aqui você pode adicionar lógica para a arena PvP
            });

            backButton.addEventListener('click', () => {
                document.getElementById('game').style.display = 'none';
                document.getElementById('menu').style.display = 'block';
            });

            backArenaButton.addEventListener('click', () => {
                document.getElementById('arena').style.display = 'none';
                document.getElementById('menu').style.display = 'block';
            });
        });

        socket.on('updatePlayers', (updatedPlayers) => {
            players = updatedPlayers;
            atualizarMapa();
            atualizarStatus();
        });

        socket.on('updateItems', (updatedItems) => {
            items = updatedItems;
            atualizarLoot();
        });

        function atualizarMapa() {
            mapDiv.innerHTML = ''; // Limpa o mapa
            for (const id in players) {
                const player = players[id];
                const playerDiv = document.createElement('div');
                playerDiv.classList.add('player');
                playerDiv.style.left = player.x * 30 + 'px'; // Ajuste a escala
                playerDiv.style.top = player.y * 30 + 'px'; // Ajuste a escala
                mapDiv.appendChild(playerDiv);
            }
        }

        function atualizarLoot() {
            const lootDiv = document.createElement('div');
            lootDiv.innerHTML = ''; // Limpa o loot
            for (const item of items) {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('item');
                itemDiv.style.left = item.x * 30 + 'px'; // Ajuste a escala
                itemDiv.style.top = item.y * 30 + 'px'; // Ajuste a escala
                itemDiv.setAttribute('id', item.id);
                lootDiv.appendChild(itemDiv);
                lootDiv.addEventListener('click', () => {
                    socket.emit('collectItem', item.id);
                });
            }
            mapDiv.appendChild(lootDiv);
        }

        function atualizarStatus() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '';
            for (const id in players) {
                const player = players[id];
                statusDiv.innerHTML += `${player.name} - Saúde: ${player.health} - Nível: ${player.level} <br>`;
            }
        }

        document.addEventListener('keydown', (event) => {
            let dx = 0;
            let dy = 0;
            switch (event.key) {
                case 'ArrowUp':
                    dy = -1;
                    break;
                case 'ArrowDown':
                    dy = 1;
                    break;
                case 'ArrowLeft':
                    dx = -1;
                    break;
                case 'ArrowRight':
                    dx = 1;
                    break;
            }
            if (dx !== 0 || dy !== 0) {
                socket.emit('move', { dx, dy });
            }
        });
    </script>
</body>
</html>
